<!DOCTYPE html>
<meta name="robots" content="noindex">
<html>
<head>
<script src="https://cdn.jsdelivr.net/momentjs/2.14.1/moment.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Counter</title>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', arial, sans-serif;
            text-align: center;
            font-size: 100px;
            padding-top: 10vh;
            /* display: flex; */
            justify-content: center;
            background: #232323;
            color: #efead2;
          }

        input {
            padding: 4px;
            border: none;
            color: #232323;
            background: #e9e7df;
            margin-bottom: 2rem;
        }
      </style>
</head>
<body>
    <input type="text" id="startTime">
    <div id="counter"></div>

    <script>
        function parseTime(time = '') {
            try {
                let parts = time.split(':');

                let startTime = moment();
                startTime.hours(parts[0]);
                startTime.minutes(parts[1]);
                startTime.seconds(0);
                startTime.milliseconds(0);
                return startTime;

            } catch (e) {
                console.error(`invalid time input: ${time}`);
                return null;
            }
        }

        function getStartTime() {
            let startTime = moment();
            startTime.hours(3);
            startTime.minutes(50);
            startTime.seconds(0);
            startTime.milliseconds(0);

            let search = window.location.search || '';
            search = search.replace(/\?/g, '');
            let times = search.split('&')
                .map(p => p.split('='))
                .map(p => ({key: p[0], value: p[1]}))
                .filter(p => p.key === 'time')
                .map(p => p.value);

            if (times.length) {
                let time = parseTime(times[0]);
                startTime = time || startTime;
                console.log('found time', !!time, times[0], time);
            } else {
                console.log('no time found', search);
            }

            return startTime;
        }

        let startTimeEl = document.getElementById('startTime');
        let counterElement = document.getElementById('counter');

        startTime = getStartTime();

        startTimeEl.addEventListener('change', function () {
            console.log(startTimeEl.value);
        });

        function render() {
            let now = moment();
            now.milliseconds(0);
            let time = moment(now - startTime);
            counterElement.innerHTML = time.format("HH:mm:ss");
            window.requestAnimationFrame(render);
        }

        window.requestAnimationFrame(render);
    </script>
</body>
</html>
